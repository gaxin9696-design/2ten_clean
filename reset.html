<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Đặt lại mật khẩu</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body{
      margin:0;
      font-family: system-ui;
      background:#0b1220;
      color:#e8eefc;
      display:flex;
      align-items:center;
      justify-content:center;
      height:100vh;
    }
    .card{
      width:360px;
      background: rgba(255,255,255,.05);
      padding:24px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.1);
    }
    input{
      width:100%;
      padding:10px;
      margin-top:10px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,.2);
      background:#111a2e;
      color:#fff;
    }
    button{
      width:100%;
      margin-top:16px;
      padding:10px;
      border-radius:8px;
      border:none;
      background:#4f8cff;
      color:#fff;
      font-weight:bold;
      cursor:pointer;
    }
    .msg{ margin-top:14px; font-size:14px; }
    .ok{ color:#7CFFB2; }
    .err{ color:#ff8c8c; }
  </style>
</head>
<body>

<div class="card">
  <h2>Đặt lại mật khẩu</h2>

  <input type="password" id="newPassword" placeholder="Mật khẩu mới" />
  <input type="password" id="confirmPassword" placeholder="Nhập lại mật khẩu" />

  <button id="btnUpdate">Cập nhật mật khẩu</button>

  <div id="msg" class="msg"></div>
</div>

<script>
  const SUPABASE_URL = "https://nzalaxolteaiafvuceqz.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im56YWxheG9sdGVhaWFmdnVjZXF6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAyOTY2MjAsImV4cCI6MjA4NTg3MjYyMH0.0eIz6cfB4Dr_g5Wja70tZCMvVfUKoI5H4D8MJBP49Bg";
  const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  const msg = document.getElementById("msg");

  async function updatePassword(){
    const pw1 = document.getElementById("newPassword").value;
    const pw2 = document.getElementById("confirmPassword").value;

    if(!pw1 || !pw2){
      msg.innerHTML = '<span class="err">Nhập đủ mật khẩu.</span>';
      return;
    }

    if(pw1 !== pw2){
      msg.innerHTML = '<span class="err">Mật khẩu không khớp.</span>';
      return;
    }

    msg.textContent = "Đang cập nhật...";

    const { error } = await sb.auth.updateUser({
      password: pw1
    });

    if(error){
      msg.innerHTML = '<span class="err">' + error.message + '</span>';
      return;
    }

    msg.innerHTML = '<span class="ok">Đổi mật khẩu thành công!</span>';

    setTimeout(()=>{
      window.location.href = "sql.html";
    },1500);
  }

  document.getElementById("btnUpdate")
    .addEventListener("click", updatePassword);
</script>

</body>
</html>
